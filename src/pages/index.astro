---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import PostList from '../components/PostList.astro';
import { getCollection } from 'astro:content';
import { SITE } from '../site.config';

const posts = (await getCollection('posts', ({ data }) => data.lang === 'zh-CN' && !data.draft))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .map(p => ({
    slug: p.data.translationSlug,
    title: p.data.title,
    description: p.data.description,
    date: p.data.date
  }));

const alternates = {
  'zh-CN': new URL('/', SITE.domain).href,
  en: new URL('/en/', SITE.domain).href
};
---

<Layout lang="zh-CN" description="konakona 的个人博客" alternates={alternates}>
  <script is:inline src="/scripts/lang-detect.js"></script>
  <Header lang="zh-CN" toZh="/" toEn="/en/" />
  <main class="animate">
    <PostList posts={posts} lang="zh-CN" />
  </main>
</Layout>
