---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import FolderView from '../../components/FolderView.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import { getCollection } from 'astro:content';
import { buildFolderStructure, getAllFolderPaths } from '../../utils/folders';
import { getLocalizedFolderName } from '../../utils/folderLocalization';
import { SITE } from '../../site.config';

export async function getStaticPaths() {
  const allPosts = await getCollection('posts', ({ data }) => data.lang === 'zh-CN' && !data.draft);
  const folderPaths = getAllFolderPaths(allPosts, 'zh-CN');
  
  return folderPaths.map(path => ({
    params: { folder: path },
    props: { folderPath: path }
  }));
}

const { folderPath } = Astro.props;
const allPosts = await getCollection('posts', ({ data }) => data.lang === 'zh-CN' && !data.draft);
const structure = buildFolderStructure(allPosts, folderPath);

const folderName = getLocalizedFolderName(folderPath, 'zh-CN');
const title = `${folderName} - konakona's Lodge`;
const description = `${folderName} 文件夹`;

const alternates = {
  'zh-CN': new URL(`/folders/${folderPath}/`, SITE.domain).href,
  en: new URL(`/en/folders/${folderPath}/`, SITE.domain).href
};
---

<Layout lang="zh-CN" {title} {description} alternates={alternates}>
  <Header lang="zh-CN" toZh={`/folders/${folderPath}/`} toEn={`/en/folders/${folderPath}/`} />
  <main class="animate">
    <Breadcrumbs currentPath={folderPath} lang="zh-CN" />
    <FolderView {structure} lang="zh-CN" currentPath={folderPath} />
  </main>
</Layout>
